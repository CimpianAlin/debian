#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

# Add here any variable or target overrides you need.

build/freenet-daemon::
	cd $(CURDIR)/contrib-@RELEASE@/freenet-ext/ && ant -propertyfile $(CURDIR)/debian/contrib.override.properties -Dgit.revision=@EXTREVISION@ package
	cd $(CURDIR)/fred-@RELEASE@/ && ant -f build-clean.xml -Dcontrib.dir=../contrib-@RELEASE@/freenet-ext -Dtest.skip=true -Dgit.revision=@REVISION@ package

install/freenet-daemon::
	install -m 644 -t $(CURDIR)/debian/freenet-daemon/usr/share/java \
	  $(CURDIR)/contrib-@RELEASE@/freenet-ext/dist/wrapper.jar \
	  $(CURDIR)/contrib-@RELEASE@/freenet-ext/dist/db4o.jar \
	  $(CURDIR)/contrib-@RELEASE@/freenet-ext/dist/lzmajio.jar \
	  $(CURDIR)/contrib-@RELEASE@/freenet-ext/dist/mantissa.jar \
	  $(CURDIR)/fred-@RELEASE@/dist/freenet.jar
	install -m 644 -t $(CURDIR)/debian/freenet-daemon/usr/lib/java \
	  $(CURDIR)/contrib-@RELEASE@/freenet-ext/dist/freenet-ext.jar

clean::
	cd $(CURDIR)/fred-@RELEASE@/ && ant -f build-clean.xml clean-all
	cd $(CURDIR)/contrib-@RELEASE@/freenet-ext/ && ant clean-all
	# rm -rf $(CURDIR)/contrib-@RELEASE@/freenet-ext/lib/ && mkdir $(CURDIR)/contrib-@RELEASE@/freenet-ext/lib/
